<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Local DocChat (Ollama)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { margin:0; font-family:Segoe UI; background:#343541; color:#ececf1; display:flex; height:100vh; }
.sidebar { width:260px; background:#202123; padding:20px; border-right:1px solid #444; }
.main { flex:1; display:flex; flex-direction:column; }
button { background:#10a37f; border:none; padding:10px; color:white; cursor:pointer; }
select,input { padding:8px; background:#40414f; color:white; border:1px solid #555; }
#chat { flex:1; overflow-y:auto; padding:20px; }
.msg { margin-bottom:20px; }
.user { color:#8ab4f8; }
.bot { color:#10a37f; }
.input { display:flex; padding:20px; }
input[type=text] { flex:1; padding:14px; }
</style>
</head>

<body>

<div class="sidebar">
<h3>ðŸ“„ DocChat (Local)</h3>

<label>Model</label>
<select id="model">
  <option value="llama3:latest">Llama 3</option>
  <option value="gemma:4b">Gemma 4B</option>
</select>

<br><br>

<input type="file" id="file">
<br><br>
<button type="button" onclick="upload()">Process Document</button>

<p id="status"></p>
</div>

<div class="main">
<div id="chat">
<div class="msg bot">Upload a document and ask questions.</div>
</div>

<div class="input">
<input id="q" type="text" placeholder="Ask something..." onkeydown="if(event.key==='Enter') ask()">
<button type="button" onclick="ask()">âž¤</button>
</div>
</div>

<script>
async function upload(){
  const f=document.getElementById("file").files[0];
  const m=document.getElementById("model").value;
  if(!f) return alert("Select file");

  const fd=new FormData();
  fd.append("file",f);
  fd.append("model",m);

  const r=await fetch("/upload",{method:"POST",body:fd});
  const j=await r.json();
  document.getElementById("status").innerText=j.message||j.error;
}

async function ask(){
  const q=document.getElementById("q");
  if(!q.value) return;

  add("user",q.value);
  const msg=q.value;
  q.value="";

  const r=await fetch("/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({query:msg})
  });

  const j=await r.json();
  add("bot",j.response);
}

function add(cls,text){
  const d=document.createElement("div");
  d.className="msg "+cls;
  d.innerText=text;
  document.getElementById("chat").appendChild(d);
}
</script>

</body>
</html>
